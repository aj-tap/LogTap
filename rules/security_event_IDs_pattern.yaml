rules:
  # Account Logon & Credential Access
  - name: "Detect_EventID_4624_SuccessfulLogon"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4624\\b/, this)"
  - name: "Detect_EventID_4625_FailedLogon"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4625\\b/, this)"
  - name: "Detect_EventID_4648_ExplicitCredentialsLogon"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4648\\b/, this)"
  - name: "Detect_EventID_4768_KerberosTGTRequested"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4768\\b/, this)"
  - name: "Detect_EventID_4769_KerberosServiceTicketRequested"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4769\\b/, this)"
  - name: "Detect_EventID_4771_KerberosPreAuthFailed"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4771\\b/, this)"
  - name: "Detect_EventID_4776_NTLMCredentialValidation"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4776\\b/, this)"
  - name: "Detect_EventID_4672_SpecialPrivilegesAssignedToNewLogon"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4672\\b/, this)"

  # Account Management & Persistence
  - name: "Detect_EventID_4720_UserAccountCreated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4720\\b/, this)"
  - name: "Detect_EventID_4722_UserAccountEnabled"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4722\\b/, this)"
  - name: "Detect_EventID_4724_UserAccountPasswordResetAttempt"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4724\\b/, this)"
  - name: "Detect_EventID_4725_UserAccountDisabled"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4725\\b/, this)"
  - name: "Detect_EventID_4726_UserAccountDeleted"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4726\\b/, this)"
  - name: "Detect_EventID_4728_MemberAddedToGlobalSecurityGroup"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4728\\b/, this)"
  - name: "Detect_EventID_4732_MemberAddedToLocalSecurityGroup"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4732\\b/, this)"
  - name: "Detect_EventID_4738_UserAccountChanged"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4738\\b/, this)"
  - name: "Detect_EventID_4740_UserAccountLockedOut"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4740\\b/, this)"
  - name: "Detect_EventID_4756_MemberAddedToUniversalSecurityGroup"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4756\\b/, this)"
  - name: "Detect_EventID_4798_UserMembershipEnumerated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4798\\b/, this)"
  - name: "Detect_EventID_4799_LocalGroupMembershipEnumerated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4799\\b/, this)"

  # Process & Service Activity (Execution & Persistence)
  - name: "Detect_EventID_4688_ProcessCreated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4688\\b/, this)"
  - name: "Detect_EventID_4689_ProcessExited"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4689\\b/, this)"
  - name: "Detect_EventID_7034_ServiceCrashed" # System Log, but often correlated
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+7034\\b/, this)"
  - name: "Detect_EventID_7036_ServiceStartStop" # System Log
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+7036\\b/, this)"
  - name: "Detect_EventID_7040_ServiceStartTypeChanged" # System Log
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+7040\\b/, this)"
  - name: "Detect_EventID_7045_ServiceInstalled" # System Log
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+7045\\b/, this)"

  # Scheduled Tasks (Persistence) - Security Log
  - name: "Detect_EventID_4698_ScheduledTaskCreated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4698\\b/, this)"
  - name: "Detect_EventID_4699_ScheduledTaskDeleted"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4699\\b/, this)"
  - name: "Detect_EventID_4700_ScheduledTaskEnabled"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4700\\b/, this)"
  - name: "Detect_EventID_4701_ScheduledTaskDisabled"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4701\\b/, this)"
  - name: "Detect_EventID_4702_ScheduledTaskUpdated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4702\\b/, this)"
  # Scheduled Tasks - Microsoft-Windows-TaskScheduler/Operational Log (Often more detailed)
  - name: "Detect_TaskScheduler_EventID_106_TaskRegistered" # TaskScheduler/Operational
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+106\\b/, this)"
  - name: "Detect_TaskScheduler_EventID_140_TaskUpdated" # TaskScheduler/Operational
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+140\\b/, this)"
  - name: "Detect_TaskScheduler_EventID_200_TaskActionStarted" # TaskScheduler/Operational
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+200\\b/, this)"
  - name: "Detect_TaskScheduler_EventID_201_TaskActionCompleted" # TaskScheduler/Operational
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+201\\b/, this)"


  # PowerShell Logging (Microsoft-Windows-PowerShell/Operational)
  - name: "Detect_PowerShell_EventID_4103_ModuleLogging"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4103\\b/, this)"
  - name: "Detect_PowerShell_EventID_4104_ScriptBlockLogging"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4104\\b/, this)"

  # Defense Evasion & Log Tampering (Security Log)
  - name: "Detect_EventID_1102_AuditLogCleared"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+1102\\b/, this)"
  - name: "Detect_EventID_4719_SystemAuditPolicyChanged"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4719\\b/, this)"
  - name: "Detect_EventID_4616_SystemTimeChanged"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4616\\b/, this)"

  # Firewall & Filtering Platform (Security Log)
  - name: "Detect_EventID_4946_FirewallExceptionRuleAdded"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4946\\b/, this)"
  - name: "Detect_EventID_4947_FirewallExceptionRuleIgnored" # Corrected from previous, this is rule modified
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4947\\b/, this)"
  - name: "Detect_EventID_4950_FirewallSettingChanged"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4950\\b/, this)"
  - name: "Detect_EventID_5024_FirewallServiceStarted" # Security Log (Windows Firewall Service)
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5024\\b/, this)"
  - name: "Detect_EventID_5025_FirewallServiceStopped" # Security Log
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5025\\b/, this)"
  - name: "Detect_EventID_5031_FirewallBlockedPacket" # Security Log (WFP) - Can be noisy
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5031\\b/, this)"
  - name: "Detect_EventID_5152_FirewallBlockedNetworkConnectionWFP" # Security Log (WFP) - More specific block
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5152\\b/, this)"
  - name: "Detect_EventID_5156_FirewallAllowedConnectionWFP" # Security Log (WFP) - Can be noisy
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5156\\b/, this)"
  - name: "Detect_EventID_5157_FirewallConnectionBlockedByRuleWFP" # Security Log (WFP)
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5157\\b/, this)"

  # Object Access (Security Log - Requires specific SACL configuration)
  - name: "Detect_EventID_4656_ObjectHandleRequested"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4656\\b/, this)"
  - name: "Detect_EventID_4660_ObjectDeleted"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4660\\b/, this)"
  - name: "Detect_EventID_4663_ObjectAccessAttempted"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4663\\b/, this)"
  - name: "Detect_EventID_5140_NetworkShareObjectAccessed"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5140\\b/, this)"
  - name: "Detect_EventID_5145_NetworkShareObjectAccessChecked"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5145\\b/, this)"
  - name: "Detect_EventID_4657_RegistryValueChanged"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4657\\b/, this)"

  # Other Potentially Suspicious Events (Security Log)
  - name: "Detect_EventID_4673_PrivilegedServiceCalled"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4673\\b/, this)"
  - name: "Detect_EventID_4674_OperationAttemptedOnPrivilegedObject"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4674\\b/, this)"
  - name: "Detect_EventID_4964_SpecialGroupsAssignedToNewLogon"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4964\\b/, this)"
  - name: "Detect_EventID_5058_KeyFileSystemOperation"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5058\\b/, this)"
  - name: "Detect_EventID_5061_CryptographicOperation"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+5061\\b/, this)"
  - name: "Detect_EventID_4697_ServiceInstalledInSystem_Uncommon"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+4697\\b/, this)"

  # Sysmon Event IDs (If Sysmon logs are ingested and have 'EventID' field)
  - name: "Detect_Sysmon_EventID_1_ProcessCreation"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+1\\b/, this)" # Assuming Sysmon EventID 1
  - name: "Detect_Sysmon_EventID_3_NetworkConnection"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+3\\b/, this)" # Assuming Sysmon EventID 3
  - name: "Detect_Sysmon_EventID_7_ImageLoaded"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+7\\b/, this)" # DLL Loading
  - name: "Detect_Sysmon_EventID_8_CreateRemoteThread"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+8\\b/, this)"
  - name: "Detect_Sysmon_EventID_10_ProcessAccess"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+10\\b/, this)"
  - name: "Detect_Sysmon_EventID_11_FileCreate"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+11\\b/, this)"
  - name: "Detect_Sysmon_EventID_12_RegistryEventObjectAddDelete"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+12\\b/, this)"
  - name: "Detect_Sysmon_EventID_13_RegistryEventValueSet"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+13\\b/, this)"
  - name: "Detect_Sysmon_EventID_15_FileCreateStreamHash"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+15\\b/, this)"
  - name: "Detect_Sysmon_EventID_17_PipeCreated"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+17\\b/, this)"
  - name: "Detect_Sysmon_EventID_18_PipeConnected"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+18\\b/, this)"
  - name: "Detect_Sysmon_EventID_19_WmiEventFilter"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+19\\b/, this)"
  - name: "Detect_Sysmon_EventID_20_WmiEventConsumer"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+20\\b/, this)"
  - name: "Detect_Sysmon_EventID_21_WmiEventConsumerToFilter"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+21\\b/, this)"
  - name: "Detect_Sysmon_EventID_22_DNSEvent"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+22\\b/, this)"
  - name: "Detect_Sysmon_EventID_23_FileDelete"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+23\\b/, this)"
  - name: "Detect_Sysmon_EventID_25_ProcessTampering"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+25\\b/, this)"
  - name: "Detect_Sysmon_EventID_26_FileDeleteLogged"
    query: "grep(/\\b[Ee][Vv][Ee][Nn][Tt][Ii][Dd][\\s:=]+26\\b/, this)"

