rules:
  # Logon/Logoff Events
  - name: "Successful Logon (4624)"
    description: "Tracks successful user logons. Key for establishing user activity timelines."
    query: "this['EventID']=='4624'"
  - name: "Failed Logon (4625)"
    description: "Tracks failed user logons. Numerous failures can indicate brute-force or password spraying attempts."
    query: "this['EventID']=='4625'"
  - name: "Explicit Credentials Logon (4648)"
    description: "A user logged on using explicit credentials (e.g., 'runas'). Can indicate privilege escalation or specific tool usage for lateral movement."
    query: "this['EventID']=='4648'"
  - name: "User Logoff (4634)"
    description: "Tracks when a user actively logs off a system."
    query: "this['EventID']=='4634'"
  - name: "User Initiated Logoff (4647)"
    description: "Indicates a user initiated the logoff process. Helps distinguish from system-initiated logoffs or disconnects."
    query: "this['EventID']=='4647'"
  - name: "Session Disconnected (4779)"
    description: "A user disconnected from a Terminal Services or Remote Desktop session without logging off."
    query: "this['EventID']=='4779'"

  # Account Management Events
  - name: "User Account Created (4720)"
    description: "A new user account was created. Important for detecting unauthorized account creation for persistence."
    query: "this['EventID']=='4720'"
  - name: "User Account Enabled (4722)"
    description: "A user account was enabled. Could indicate a dormant account being reactivated for malicious use."
    query: "this['EventID']=='4722'"
  - name: "User Account Disabled (4725)"
    description: "A user account was disabled. May be legitimate, or an attacker covering tracks."
    query: "this['EventID']=='4725'"
  - name: "User Account Deleted (4726)"
    description: "A user account was deleted. Could be an attempt by an attacker to remove evidence."
    query: "this['EventID']=='4726'"
  - name: "User Account Changed (4738)"
    description: "A user account's properties were changed (e.g., password reset, group membership). Monitor for unauthorized modifications."
    query: "this['EventID']=='4738'"
  - name: "User Account Locked Out (4740)"
    description: "A user account was locked out due to too many failed logon attempts. Can indicate brute-force activity."
    query: "this['EventID']=='4740'"

  # Group Management Events
  - name: "Member Added to Security-Enabled Local Group (4732)"
    description: "A member was added to a security-enabled local group (e.g., Administrators). Critical for detecting privilege escalation."
    query: "this['EventID']=='4732' and (this['GroupName']=='Administrators' or this['GroupName']=='S-1-5-32-544')"
  - name: "Member Removed from Security-Enabled Local Group (4733)"
    description: "A member was removed from a security-enabled local group."
    query: "this['EventID']=='4733'"
  - name: "Security-Enabled Local Group Created (4731)"
    description: "A new security-enabled local group was created."
    query: "this['EventID']=='4731'"
  - name: "Security-Enabled Local Group Changed (4735)"
    description: "A security-enabled local group was changed."
    query: "this['EventID']=='4735'"
  - name: "Security-Enabled Local Group Deleted (4734)"
    description: "A security-enabled local group was deleted."
    query: "this['EventID']=='4734'"

  # Process & Service Events
  - name: "New Process Creation (4688)"
    description: "A new process has been created. Enable command-line auditing to capture full process command lines for context."
    query: "this['EventID']=='4688'"
  - name: "Suspicious Process Creation (Command Shells, Scripting) (4688)"
    description: "Detects creation of common command-line and scripting tools often used by attackers."
    query: "this['EventID']=='4688' and (grep(/powershell.exe/, this['ProcessName']) or grep(/cmd.exe/, this['ProcessName']) or grep(/wscript.exe/, this['ProcessName']) or grep(/cscript.exe/, this['ProcessName']) or grep(/rundll32.exe/, this['ProcessName']))"
  - name: "New Service Installed (4697 or System Log 7045)"
    description: "A new service was installed on the system. Common persistence technique for malware."
    query: "this['EventID']=='4697' or this['EventID']=='7045'" # Event ID 7045 is from System Log
  - name: "Service Start Type Changed (System Log 7040)"
    description: "The start type of a service was changed (e.g., from disabled to automatic). Could be malware enabling a service."
    query: "this['EventID']=='7040'" # From System Log

  # Scheduled Task Events
  - name: "Scheduled Task Created (4698)"
    description: "A new scheduled task was created. Common persistence and execution technique."
    query: "this['EventID']=='4698'"
  - name: "Scheduled Task Updated (4702)"
    description: "An existing scheduled task was updated. Attackers might modify legitimate tasks."
    query: "this['EventID']=='4702'"
  - name: "Scheduled Task Deleted (4699)"
    description: "A scheduled task was deleted. Could be attacker attempting to cover tracks."
    query: "this['EventID']=='4699'"
  - name: "Scheduled Task Enabled (4700)"
    description: "A scheduled task was enabled."
    query: "this['EventID']=='4700'"
  - name: "Scheduled Task Disabled (4701)"
    description: "A scheduled task was disabled."
    query: "this['EventID']=='4701'"

  # Evidence Tampering & System Integrity
  - name: "Audit Log Cleared (1102)"
    description: "The Windows Security audit log was cleared. Strong indicator of an attempt to cover tracks."
    query: "this['EventID']=='1102'"
  - name: "System Time Changed (4616)"
    description: "The system time was changed. Can be used by attackers to disrupt logging or bypass time-based controls."
    query: "this['EventID']=='4616'"
  - name: "Windows Firewall Rule Added (4946)"
    description: "A rule was added to the Windows Firewall exception list. Could be an attacker opening ports."
    query: "this['EventID']=='4946'"
  - name: "Windows Firewall Rule Modified (4947)"
    description: "A rule was modified in the Windows Firewall exception list."
    query: "this['EventID']=='4947'"
  - name: "Windows Firewall Setting Changed (4950)"
    description: "A setting was changed in Windows Firewall, potentially disabling it or parts of it."
    query: "this['EventID']=='4950'"

  # PowerShell Logging
  - name: "PowerShell Module Logging (4103)"
    description: "PowerShell module logging events. Provides details on cmdlet execution and parameters."
    query: "this['EventID']=='4103'"
  - name: "PowerShell Script Block Logging (4104)"
    description: "Logs deobfuscated PowerShell script blocks. Extremely valuable for detecting malicious PowerShell."
    query: "this['EventID']=='4104'"

  # Object Access (Enable these audit policies with care due to volume)
  - name: "Registry Value Modified (4657)"
    description: "A registry value was modified. Monitor critical keys for unauthorized changes (e.g., Run keys for persistence)."
    query: "this['EventID']=='4657' and (grep(/\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run/, this['ObjectName']) or grep(/\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce/, this['ObjectName']) or grep(/\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Userinit/, this['ObjectName']) or grep(/\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon\\\\Shell/, this['ObjectName']))"
  - name: "File Share Accessed (5140)"
    description: "A network share object was accessed. Logs the first access to a share per session."
    query: "this['EventID']=='5140'"
  - name: "Detailed File Share Access (5145)"
    description: "Detailed information about access to a file or folder on a network share (requires 'Detailed File Share' auditing). Can be very verbose."
    query: "this['EventID']=='5145'"
  - name: "File System Object Accessed (4663)"
    description: "An attempt was made to access an object (e.g., file, folder). Requires specific SACLs on objects."
    query: "this['EventID']=='4663'"
  - name: "File System Object Created (4656)"
    description: "A handle to an object was requested with intent to create it (e.g., new file). Requires specific SACLs on objects."
    query: "this['EventID']=='4656'"
  - name: "File System Object Deleted (4660)"
    description: "An object was deleted (e.g., file, folder). Requires specific SACLs on objects."
    query: "this['EventID']=='4660'"

  # Other
  - name: "Special Privileges Assigned to New Logon (4672)"
    description: "Special privileges (like SeDebugPrivilege) were assigned to a new logon session. Important for detecting potential privilege escalation."
    query: "this['EventID']=='4672'"